<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAVENCOIN Mining Dashboard | 2miners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0a1c 0%, #1a1428 50%, #0d0917 100%);
            min-height: 100vh;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(138, 43, 226, 0.05);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 12px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 0.9rem;
        }

        .worker-name {
            font-size: 1.1rem;
            color: #9b59b6;
            margin-top: 8px;
        }

        .wallet-address {
            font-size: 0.75rem;
            color: #9b59b6;
            word-break: break-all;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(138, 43, 226, 0.4);
            transform: translateY(-2px);
        }

        .stat-card.highlight {
            border-color: rgba(138, 43, 226, 0.3);
            background: rgba(138, 43, 226, 0.05);
        }

        .stat-card.offline {
            border-color: rgba(244, 91, 91, 0.3);
            background: rgba(244, 91, 91, 0.05);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
        }

        .stat-value.purple { color: #9b59b6; }
        .stat-value.blue { color: #5b9cf4; }
        .stat-value.yellow { color: #f4c95b; }
        .stat-value.red { color: #f45b5b; }
        .stat-value.green { color: #49ce9b; }

        .stat-sub {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .section-title {
            font-size: 1.3rem;
            color: #9b59b6;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
        }

        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.02);
            border-radius: 12px;
            overflow: hidden;
        }

        .data-table th {
            background: rgba(138, 43, 226, 0.1);
            padding: 15px;
            text-align: left;
            font-size: 0.85rem;
            color: #9b59b6;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .data-table tr:hover {
            background: rgba(138, 43, 226, 0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .status-badge.online {
            background: rgba(73, 206, 155, 0.2);
            color: #49ce9b;
        }

        .status-badge.offline {
            background: rgba(244, 91, 91, 0.2);
            color: #f45b5b;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }

        .nav-links a {
            color: #9b59b6;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 6px;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .nav-links a:hover {
            background: rgba(138, 43, 226, 0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
        }

        .summary-value {
            font-size: 1.2rem;
            color: #9b59b6;
            margin-top: 5px;
        }

        .refresh-info {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            color: #666;
            font-size: 0.85rem;
        }

        .refresh-info span {
            color: #9b59b6;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(138, 43, 226, 0.1);
            border-top-color: #9b59b6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(244, 91, 91, 0.1);
            border: 1px solid rgba(244, 91, 91, 0.3);
            color: #f45b5b;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .stat-value { font-size: 1.5rem; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RAVENCOIN MINING</h1>
            <div class="subtitle">2miners Pool | Real-time Dashboard</div>
            <div class="worker-name" id="workerName">merlin3090ti</div>
            <div class="wallet-address" id="walletAddress">Loading...</div>
            <nav class="nav-links">
                <a href="/">PERPHIVE</a>
                <a href="/kaspa.html">KASPA Solo</a>
            </nav>
        </header>

        <div id="content">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div>Connecting to 2miners API...</div>
            </div>
        </div>

        <div class="refresh-info">
            Auto-refresh every <span>30 seconds</span> | Last update: <span id="lastUpdate">--</span>
        </div>
    </div>

    <script>
        const WALLET = 'RKPyKUJ8gGmRSDAt7ueNkmdAPF12vjuALT';
        const API_URL = `https://rvn.2miners.com/api/accounts/${WALLET}`;

        document.getElementById('walletAddress').textContent = WALLET;

        // Format hashrate (RVN uses MH/s typically for GPU mining)
        function formatHashrate(hashrate) {
            if (!hashrate || hashrate === 0) return '0 H/s';
            const units = ['H/s', 'KH/s', 'MH/s', 'GH/s', 'TH/s'];
            let unitIndex = 0;
            let value = hashrate;
            while (value >= 1000 && unitIndex < units.length - 1) {
                value /= 1000;
                unitIndex++;
            }
            return value.toFixed(2) + ' ' + units[unitIndex];
        }

        // Format RVN amount (satoshis to RVN)
        function formatRVN(sats) {
            if (!sats) return '0 RVN';
            const rvn = sats / 100000000;
            if (rvn >= 1000) return rvn.toFixed(2) + ' RVN';
            if (rvn >= 1) return rvn.toFixed(4) + ' RVN';
            return rvn.toFixed(8) + ' RVN';
        }

        // Format time ago
        function timeAgo(timestamp) {
            const seconds = Math.floor((Date.now() / 1000) - timestamp);
            if (seconds < 60) return seconds + 's ago';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }

        // Format date
        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Render dashboard
        function renderDashboard(data) {
            const content = document.getElementById('content');

            const hashrate = data.currentHashrate || 0;
            const avgHashrate = data.hashrate || 0;
            const luck = data.currentLuck || '0';

            const balance = data.stats?.balance || 0;
            const paid = data.stats?.paid || 0;
            const blocksFound = data.stats?.blocksFound || 0;
            const lastShare = data.stats?.lastShare || 0;

            const workersOnline = data.workersOnline || 0;
            const workersTotal = data.workersTotal || 0;

            const rewards = data.rewards || [];
            const payments = data.payments || [];
            const sumRewards = data.sumrewards || [];

            const workerName = data.config?.ipWorkerName || 'Unknown';
            document.getElementById('workerName').textContent = workerName;

            const isOnline = hashrate > 0;

            content.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card ${isOnline ? 'highlight' : 'offline'}">
                        <div class="stat-label">Current Hashrate</div>
                        <div class="stat-value ${isOnline ? 'purple' : 'red'}">${formatHashrate(hashrate)}</div>
                        <div class="stat-sub">
                            ${isOnline ? 'Avg: ' + formatHashrate(avgHashrate) : 'Worker OFFLINE'}
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Worker Status</div>
                        <div class="stat-value ${isOnline ? 'green' : 'red'}">${isOnline ? 'ONLINE' : 'OFFLINE'}</div>
                        <div class="stat-sub">Last share: ${lastShare ? timeAgo(lastShare) : 'N/A'}</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Current Luck</div>
                        <div class="stat-value ${parseFloat(luck) <= 100 ? 'green' : parseFloat(luck) <= 200 ? 'yellow' : 'red'}">${luck}%</div>
                        <div class="stat-sub">${parseFloat(luck) <= 100 ? 'Lucky!' : parseFloat(luck) <= 200 ? 'Normal' : 'Unlucky period'}</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Balance</div>
                        <div class="stat-value yellow">${formatRVN(balance)}</div>
                        <div class="stat-sub">Min payout: 10 RVN</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Total Paid</div>
                        <div class="stat-value blue">${formatRVN(paid)}</div>
                        <div class="stat-sub">${data.paymentsTotal || 0} payments</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Solo Blocks Found</div>
                        <div class="stat-value green">${blocksFound}</div>
                        <div class="stat-sub">Full block rewards</div>
                    </div>
                </div>

                <!-- Earnings Summary -->
                <div style="margin-bottom: 30px;">
                    <h2 class="section-title">Earnings Summary</h2>
                    <div class="summary-grid">
                        ${sumRewards.map(s => `
                            <div class="summary-item">
                                <div class="summary-label">${s.name}</div>
                                <div class="summary-value">${formatRVN(s.reward)}</div>
                                <div style="font-size: 0.75rem; color: #666;">${s.numreward} shares</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Recent Payments -->
                ${payments.length > 0 ? `
                <div style="margin-bottom: 30px;">
                    <h2 class="section-title">Recent Payments</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>TX</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${payments.slice(0, 10).map(p => `
                                    <tr>
                                        <td style="color: #49ce9b;">${formatRVN(p.amount)}</td>
                                        <td>${formatDate(p.timestamp)}</td>
                                        <td>
                                            <a href="https://ravencoin.network/tx/${p.tx}" target="_blank"
                                               style="color: #5b9cf4; text-decoration: none;">
                                                ${p.tx.substring(0, 12)}...
                                            </a>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                ` : ''}

                <!-- Recent Rewards -->
                ${rewards.length > 0 ? `
                <div>
                    <h2 class="section-title">Recent Pool Rewards</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Block</th>
                                    <th>Reward</th>
                                    <th>Share %</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rewards.slice(0, 15).map(r => `
                                    <tr>
                                        <td>
                                            <a href="https://ravencoin.network/block/${r.blockheight}" target="_blank"
                                               style="color: #5b9cf4; text-decoration: none;">
                                                #${r.blockheight}
                                            </a>
                                        </td>
                                        <td>${formatRVN(r.reward)}</td>
                                        <td>${(r.percent * 100).toFixed(6)}%</td>
                                        <td>${timeAgo(r.timestamp)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Fetch data
        async function fetchData() {
            try {
                const resp = await fetch(API_URL);
                if (!resp.ok) throw new Error('API error: ' + resp.status);
                const data = await resp.json();
                renderDashboard(data);
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            } catch (err) {
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <p>Failed to fetch mining data</p>
                        <p style="font-size: 0.85rem; margin-top: 10px;">${err.message}</p>
                    </div>
                `;
            }
        }

        // Initial fetch
        fetchData();

        // Auto refresh every 30 seconds
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
